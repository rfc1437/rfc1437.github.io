<!DOCTYPE html>
<html lang="de-de">
<head>
          <title>Hugo's House of Blog Horror - Make runfcgi fail when database connection is open before fork</title>
        <meta charset="utf-8" />
        <meta name="generator" content="Pelican" />
        <link href="https://rfc1437.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Hugo's House of Blog Horror Full Atom Feed" />
        <link href="https://rfc1437.github.io/feeds/asides.atom.xml" type="application/atom+xml" rel="alternate" title="Hugo's House of Blog Horror Categories Atom Feed" />




    <meta name="tags" content="Datenbank" />
    <meta name="tags" content="Django" />
    <meta name="tags" content="Programmieren" />
    <meta name="tags" content="Python" />
    <meta name="tags" content="Sysadmin" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://rfc1437.github.io/">Hugo's House of Blog Horror</a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/impressum.html">Imprint</a></li>
            <li><a href="/about.html">About</a></li>
            <li><a href="https://rfc1437.github.io/category/artikel.html">Artikel</a></li>
            <li class="active"><a href="https://rfc1437.github.io/category/asides.html">Asides</a></li>
            <li><a href="https://rfc1437.github.io/category/galerie.html">Galerie</a></li>
            <li><a href="https://rfc1437.github.io/category/kochbuch.html">Kochbuch</a></li>
            <li><a href="https://rfc1437.github.io/category/metaowl.html">Metaowl</a></li>
            <li><a href="https://rfc1437.github.io/category/misc.html">misc</a></li>
            <li><a href="https://rfc1437.github.io/category/spielelog.html">Spielelog</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="https://rfc1437.github.io/make-runfcgi-fail-when-database-connection-is-open-before-fork.html" rel="bookmark"
         title="Permalink to Make runfcgi fail when database connection is open before fork">Make runfcgi fail when database connection is open before fork</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2012-06-20T13:26:00+02:00">
      Mi 20 Juni 2012
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="https://rfc1437.github.io/author/hugo.html">hugo</a>
    </address>
    <div class="category">
        Category: <a href="https://rfc1437.github.io/category/asides.html">Asides</a>
    </div>
    <div class="tags">
        Tags:
            <a href="https://rfc1437.github.io/tag/datenbank.html">Datenbank</a>
            <a href="https://rfc1437.github.io/tag/django.html">Django</a>
            <a href="https://rfc1437.github.io/tag/programmieren.html">Programmieren</a>
            <a href="https://rfc1437.github.io/tag/python.html">Python</a>
            <a href="https://rfc1437.github.io/tag/sysadmin.html">Sysadmin</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><a href="http://djangosnippets.org/snippets/2390/">Make runfcgi fail when database connection is open before fork</a>. Das ist eine Sache nach der ich schon ewige Zeiten jage, zuletzt in ein paar ziemlich wichtigen Projekten. Flup arbeitet so, dass es die WSGI-Anwendung erst initialisiert und mit dieser initialisierten WSGI Anwendung dann die Forks für die Worker macht. Dummerweise gibt es bei uns aber Datenbankzugriffe wärend der Anwendungsinitialisierung - dadurch hat der Basisprozess schon eine offene Datenbankverbindung, jeder Fork kopiert diese Daten. Aber der Socket der Verbindung geht natürlich nicht mit - der neue Prozess denkt nur er wäre verbunden, ist es aber nicht. Zugriffe von denen neuen Prozessen fallen dann mit einer Exception raus. Man kann im verlinkten Patch auch gut den raise auf die Exception einfach durch connection.connection = None ersetzen. Dann wird einfach die Verbindung die sowieso defekt ist weggeworfen und in neuen Prozessen immer eine neue Verbindung aufgebaut. Damit haben wir zumindestens in einem Produktionsumfeld (mit psycopg2) das ganze beheben können und sind guten Mutes, dass es auch bei der Umgebung  mit pyodbc helfen wird.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>